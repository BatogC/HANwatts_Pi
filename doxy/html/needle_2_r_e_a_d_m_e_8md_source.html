<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Raspberry Pi software: node-red-1881/node_modules/needle/README.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Raspberry Pi software
   &#160;<span id="projectnumber">2.0</span>
   </div>
   <div id="projectbrief">Scripts and libraries used by the Raspberry Pi</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('needle_2_r_e_a_d_m_e_8md.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">node-red-1881/node_modules/needle/README.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="needle_2_r_e_a_d_m_e_8md.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;Needle</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;======</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;[![NPM](https://nodei.co/npm/needle.png)](https://nodei.co/npm/needle/)</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;The leanest and most handsome HTTP client in the Nodelands.</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;```js</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;var needle = require(&#39;needle&#39;);</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;needle.get(&#39;http://www.google.com&#39;, function(error, response) {</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;  if (!error &amp;&amp; response.statusCode == 200)</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;    console.log(response.body);</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;});</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;```</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;Callbacks not floating your boat? Needle got your back.</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;``` js</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;var data = {</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;  file: &#39;/home/johnlennon/walrus.png&#39;,</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;  content_type: &#39;image/png&#39;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;};</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;// the callback is optional, and needle returns a `readableStream` object</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;// that triggers a &#39;done&#39; event when the request/response process is complete.</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;needle</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  .post(&#39;https://my.server.com/foo&#39;, data, { multipart: true })</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  .on(&#39;readable&#39;, function() { /* eat your chunks */ })</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  .on(&#39;done&#39;, function(err, resp) {</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    console.log(&#39;Ready-o!&#39;);</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  })</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;```</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;From version 2.0.x up, Promises are also supported. Just call `needle()` directly and you&#39;ll get a native Promise object.</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;```js</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;needle(&#39;put&#39;, &#39;https://hacking.the.gibson/login&#39;, { password: &#39;god&#39; }, { json: true })</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  .then(function(response) {</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    return doSomethingWith(response)</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  })</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  .catch(function(err) {</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    console.log(&#39;Call the locksmith!&#39;)</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  })</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;```</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;With only two real dependencies, Needle supports:</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160; - HTTP/HTTPS requests, with the usual verbs you would expect</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160; - All of Node&#39;s native TLS options, such as &#39;rejectUnauthorized&#39; (see below)</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160; - Basic &amp; Digest authentication with auto-detection</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160; - Multipart form-data (e.g. file uploads)</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160; - HTTP Proxy forwarding, optionally with authentication</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160; - Streaming gzip, deflate, and brotli decompression</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160; - Automatic XML &amp; JSON parsing</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160; - 301/302/303 redirect following, with fine-grained tuning, and</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160; - Streaming non-UTF-8 charset decoding, via `iconv-lite`</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;And yes, Mr. Wayne, it does come in black.</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;This makes Needle an ideal alternative for performing quick HTTP requests in Node, either for API interaction, downloading or uploading streams of data, and so on. If you need OAuth, AWS support or anything fancier, you should check out mikeal&#39;s request module.</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;Install</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;-------</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;```</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;$ npm install needle</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;```</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;Usage</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;-----</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;```js</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;// using promises</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;needle(&#39;get&#39;, &#39;https://server.com/posts/12&#39;)</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  .then(function(resp) {</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    // ...</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  })</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  .catch(function(err) {</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    // ...</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  });</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;// with callback</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;needle.get(&#39;ifconfig.me/all.json&#39;, function(error, response, body) {</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  if (error) throw error;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  // body is an alias for `response.body`,</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  // that in this case holds a JSON-decoded object.</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  console.log(body.ip_addr);</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;});</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;// no callback, using streams</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;var out = fs.createWriteStream(&#39;logo.png&#39;);</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;needle.get(&#39;https://google.com/images/logo.png&#39;).pipe(out).on(&#39;done&#39;, function() {</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  console.log(&#39;Pipe finished!&#39;);</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;});</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;```</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;As you can see, you can use Needle with Promises or without them. When using Promises or when a callback is passed, the response&#39;s body will be buffered and written to `response.body`, and the callback will be fired when all of the data has been collected and processed (e.g. decompressed, decoded and/or parsed).</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;When no callback is passed, however, the buffering logic will be skipped but the response stream will still go through Needle&#39;s processing pipeline, so you get all the benefits of post-processing while keeping the streamishness we all love from Node.</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;Response pipeline</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;-----------------</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;Depending on the response&#39;s Content-Type, Needle will either attempt to parse JSON or XML streams, or, if a text response was received, will ensure that the final encoding you get is UTF-8.</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;You can also request a gzip/deflated/brotli response, which, if sent by the server, will be processed before parsing or decoding is performed. (Note: brotli is only supported on Node 10.16.0 or above, and will not be requested or processed on earlier versions.)</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;```js</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;needle.get(&#39;http://stackoverflow.com/feeds&#39;, { compressed: true }, function(err, resp) {</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  console.log(resp.body); // this little guy won&#39;t be a Gzipped binary blob</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                          // but a nice object containing all the latest entries</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;});</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;```</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;Or in anti-callback mode, using a few other options:</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;```js</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;var options = {</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  compressed         : true, // sets &#39;Accept-Encoding&#39; to &#39;gzip, deflate, br&#39;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  follow_max         : 5,    // follow up to five redirects</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  rejectUnauthorized : true  // verify SSL certificate</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;}</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;var stream = needle.get(&#39;https://backend.server.com/everything.html&#39;, options);</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;// read the chunks from the &#39;readable&#39; event, so the stream gets consumed.</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;stream.on(&#39;readable&#39;, function() {</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  while (data = this.read()) {</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    console.log(data.toString());</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  }</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;})</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;stream.on(&#39;done&#39;, function(err) {</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  // if our request had an error, our &#39;done&#39; event will tell us.</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  if (!err) console.log(&#39;Great success!&#39;);</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;})</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;```</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;API</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;---</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;### needle(method, url[, data][, options][, callback]) `(&gt; 2.0.x)`</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;Calling `needle()` directly returns a Promise. Besides `method` and `url`, all parameters are optional, although when sending a `post`, `put` or `patch` request you will get an error if `data` is not present.</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;```js</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;needle(&#39;get&#39;, &#39;http://some.url.com&#39;)</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  .then(function(resp) { console.log(resp.body) })</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  .catch(function(err) { console.error(err) })</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;})</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;```</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;Except from the above, all of Needle&#39;s request methods return a Readable stream, and both `options` and `callback` are optional. If passed, the callback will return three arguments: `error`, `response` and `body`, which is basically an alias for `response.body`.</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;### needle.head(url[, options][, callback])</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;```js</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;needle.head(&#39;https://my.backend.server.com&#39;, {</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  open_timeout: 5000 // if we&#39;re not able to open a connection in 5 seconds, boom.</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;}, function(err, resp) {</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  if (err)</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    console.log(&#39;Shoot! Something is wrong: &#39; + err.message)</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  else</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    console.log(&#39;Yup, still alive.&#39;)</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;})</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;```</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;### needle.get(url[, options][, callback])</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;```js</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;needle.get(&#39;google.com/search?q=syd+barrett&#39;, function(err, resp) {</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  // if no http:// is found, Needle will automagically prepend it.</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;});</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;```</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;### needle.post(url, data[, options][, callback])</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;```js</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;var options = {</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  headers: { &#39;X-Custom-Header&#39;: &#39;Bumbaway atuna&#39; }</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;}</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;needle.post(&#39;https://my.app.com/endpoint&#39;, &#39;foo=bar&#39;, options, function(err, resp) {</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  // you can pass params as a string or as an object.</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;});</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;```</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;### needle.put(url, data[, options][, callback])</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;```js</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;var nested = {</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  params: {</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    are: {</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      also: &#39;supported&#39;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    }</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  }</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;}</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;needle.put(&#39;https://api.app.com/v2&#39;, nested, function(err, resp) {</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  console.log(&#39;Got &#39; + resp.bytes + &#39; bytes.&#39;) // another nice treat from this handsome fella.</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;});</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;```</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;### needle.patch(url, data[, options][, callback])</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;Same behaviour as PUT.</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;### needle.delete(url, data[, options][, callback])</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;```js</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;var options = {</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  username: &#39;fidelio&#39;,</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  password: &#39;x&#39;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;}</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;needle.delete(&#39;https://api.app.com/messages/123&#39;, null, options, function(err, resp) {</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  // in this case, data may be null, but you need to explicity pass it.</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;});</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;```</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;### needle.request(method, url, data[, options][, callback])</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;Generic request. This not only allows for flexibility, but also lets you perform a GET request with data, in which case will be appended to the request as a query string, unless you pass a `json: true` option (read below).</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;```js</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;var params = {</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  q    : &#39;a very smart query&#39;,</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  page : 2</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;}</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;needle.request(&#39;get&#39;, &#39;forum.com/search&#39;, params, function(err, resp) {</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  if (!err &amp;&amp; resp.statusCode == 200)</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    console.log(resp.body); // here you go, mister.</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;});</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;```</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;Now, if you set pass `json: true` among the options, Needle won&#39;t set your params as a querystring but instead send a JSON representation of your data through the request&#39;s body, as well as set the `Content-Type` and `Accept` headers to `application/json`.</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;```js</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;needle.request(&#39;get&#39;, &#39;forum.com/search&#39;, params, { json: true }, function(err, resp) {</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  if (resp.statusCode == 200) console.log(&#39;It worked!&#39;);</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;});</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;```</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;Events</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;------</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;The [Readable stream](https://nodejs.org/api/stream.html#stream_class_stream_readable) object returned by the above request methods emits the following events, in addition to the regular ones (e.g. `end`, `close`, `data`, `pipe`, `readable`).</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;### Event: `&#39;response&#39;`</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160; - `response &lt;http.IncomingMessage&gt;`</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;Emitted when the underlying [http.ClientRequest](https://nodejs.org/api/http.html#http_class_http_clientrequest) emits a response event. This is after the connection is established and the header received, but before any of it is processed (e.g. authorization required or redirect to be followed). No data has been consumed at this point.</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;### Event: `&#39;redirect&#39;`</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160; - `location &lt;String&gt;`</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;Indicates that the a redirect is being followed. This means that the response code was a redirect (`301`, `302`, `303`, `307`) and the given [redirect options](#redirect-options) allowed following the URL received in the `Location` header.</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;### Event: `&#39;header&#39;`</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160; - `statusCode &lt;Integer&gt;`</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160; - `headers &lt;Object&gt;`</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;Triggered after the header has been processed, and just before the data is to be consumed. This implies that no redirect was followed and/or authentication header was received. In other words, we got a &quot;valid&quot; response.</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;### Event: `&#39;done&#39;` (previously &#39;end&#39;)</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160; - `exception &lt;Error&gt;` (optional)</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;Emitted when the request/response process has finished, either because all data was consumed or an error ocurred somewhere in between. Unlike a regular stream&#39;s `end` event, Needle&#39;s `done` will be fired either on success or on failure, which is why the first argument may be an Error object. In other words:</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;```js</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;var resp = needle.get(&#39;something.worthy/of/being/streamed/by/needle&#39;);</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;resp.pipe(someWritableStream);</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;resp.on(&#39;done&#39;, function(err) {</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  if (err) console.log(&#39;An error ocurred: &#39; + err.message);</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  else console.log(&#39;Great success!&#39;);</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;})</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;```</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;### Event: `&#39;err&#39;`</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160; - `exception &lt;Error&gt;`</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;Emitted when an error ocurrs. This should only happen once in the lifecycle of a Needle request.</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;### Event: `&#39;timeout&#39;`</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160; - `type &lt;String&gt;`</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;Emitted when an timeout error occurs. Type can be either &#39;open&#39;, &#39;response&#39;, or &#39;read&#39;. This will called right before aborting the request, which will also trigger an `err` event, a described above, with an `ECONNRESET` (Socket hang up) exception.</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;Request options</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;---------------</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;For information about options that&#39;ve changed, there&#39;s always [the changelog](https://github.com/tomas/needle/releases).</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160; - `agent`       : Uses an [http.Agent](https://nodejs.org/api/http.html#http_class_http_agent) of your choice, instead of the global, default one. Useful for tweaking the behaviour at the connection level, such as when doing tunneling (see below for an example).</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160; - `json`        : When `true`, sets content type to `application/json` and sends request body as JSON string, instead of a query string.</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160; - `open_timeout`: (or `timeout`) Returns error if connection takes longer than X milisecs to establish. Defaults to `10000` (10 secs). `0` means no timeout.</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160; - `response_timeout`: Returns error if no response headers are received in X milisecs, counting from when the connection is opened. Defaults to `0` (no response timeout).</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160; - `read_timeout`: Returns error if data transfer takes longer than X milisecs, once response headers are received. Defaults to `0` (no timeout).</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160; - `follow_max`  : (or `follow`) Number of redirects to follow. Defaults to `0`. See below for more redirect options.</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160; - `multipart`   : Enables multipart/form-data encoding. Defaults to `false`. Use it when uploading files.</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160; - `proxy`       : Forwards request through HTTP(s) proxy. Eg. `proxy: &#39;http://user:pass@proxy.server.com:3128&#39;`. For more advanced proxying/tunneling use a custom `agent`, as described below.</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160; - `headers`     : Object containing custom HTTP headers for request. Overrides defaults described below.</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160; - `auth`        : Determines what to do with provided username/password. Options are `auto`, `digest` or `basic` (default). `auto` will detect the type of authentication depending on the response headers.</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160; - `stream_length`: When sending streams, this lets you manually set the Content-Length header --if the stream&#39;s bytecount is known beforehand--, preventing ECONNRESET (socket hang up) errors on some servers that misbehave when receiving payloads of unknown size. Set it to `0` and Needle will get and set the stream&#39;s length for you, or leave unset for the default behaviour, which is no Content-Length header for stream payloads.</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160; - `localAddress`: &lt;string&gt;, IP address. Passed to http/https request. Local interface from witch the request should be emitted.</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160; - `uri_modifier`: Anonymous function taking request (or redirect location if following redirects) URI as an argument and modifying it given logic. It has to return a valid URI string for successful request.</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;Response options</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;----------------</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160; - `decode_response` : (or `decode`) Whether to decode the text responses to UTF-8, if Content-Type header shows a different charset. Defaults to `true`.</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160; - `parse_response`  : (or `parse`) Whether to parse XML or JSON response bodies automagically. Defaults to `true`. You can also set this to &#39;xml&#39; or &#39;json&#39; in which case Needle will *only* parse the response if the content type matches.</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160; - `output`          : Dump response output to file. This occurs after parsing and charset decoding is done.</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160; - `parse_cookies`   : Whether to parse responseâ€™s `Set-Cookie` header. Defaults to `true`. If parsed, response cookies will be available at `resp.cookies`.</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;HTTP Header options</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;-------------------</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;These are basically shortcuts to the `headers` option described above.</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160; - `cookies`   : Builds and sets a Cookie header from a `{ key: &#39;value&#39; }` object.</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160; - `compressed`: If `true`, sets &#39;Accept-Encoding&#39; header to &#39;gzip,deflate&#39;, and inflates content if zipped. Defaults to `false`.</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160; - `username`  : For HTTP basic auth.</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160; - `password`  : For HTTP basic auth. Requires username to be passed, but is optional.</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160; - `accept`    : Sets &#39;Accept&#39; HTTP header. Defaults to `*/*`.</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160; - `connection`: Sets &#39;Connection&#39; HTTP header. Not set by default, unless running Node &lt; 0.11.4 in which case it defaults to `close`. More info about this below.</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160; - `user_agent`: Sets the &#39;User-Agent&#39; HTTP header. Defaults to `Needle/{version} (Node.js {node_version})`.</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160; - `content_type`: Sets the &#39;Content-Type&#39; header. Unset by default, unless you&#39;re sending data in which case it&#39;s set accordingly to whatever is being sent (`application/x-www-form-urlencoded`, `application/json` or `multipart/form-data`). That is, of course, unless the option is passed, either here or through `options.headers`. You&#39;re the boss.</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;Node.js TLS Options</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;-------------------</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;These options are passed directly to `https.request` if present. Taken from the [original documentation](http://nodejs.org/docs/latest/api/https.html):</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160; - `pfx`                : Certificate, Private key and CA certificates to use for SSL.</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160; - `key`                : Private key to use for SSL.</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160; - `passphrase`         : A string of passphrase for the private key or pfx.</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160; - `cert`               : Public x509 certificate to use.</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160; - `ca`                 : An authority certificate or array of authority certificates to check the remote host against.</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160; - `ciphers`            : A string describing the ciphers to use or exclude.</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160; - `rejectUnauthorized` : If true, the server certificate is verified against the list of supplied CAs. An &#39;error&#39; event is emitted if verification fails. Verification happens at the connection level, before the HTTP request is sent.</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160; - `secureProtocol`     : The SSL method to use, e.g. SSLv3_method to force SSL version 3.</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160; - `family`             : IP address family to use when resolving host and hostname. Valid values are 4 or 6. When unspecified, both IP v4 and v6 will be used.</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;Redirect options</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;----------------</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;These options only apply if the `follow_max` (or `follow`) option is higher than 0.</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160; - `follow_set_cookies`      : Sends the cookies received in the `set-cookie` header as part of the following request. `false` by default.</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160; - `follow_set_referer`      : Sets the &#39;Referer&#39; header to the requested URI when following a redirect. `false` by default.</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160; - `follow_keep_method`      : If enabled, resends the request using the original verb instead of being rewritten to `get` with no data. `false` by default.</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160; - `follow_if_same_host`     : When true, Needle will only follow redirects that point to the same host as the original request. `false` by default.</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160; - `follow_if_same_protocol` : When true, Needle will only follow redirects that point to the same protocol as the original request. `false` by default.</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160; - `follow_if_same_location` : Unless true, Needle will not follow redirects that point to same location (as set in the response header) as the original request URL. `false` by default.</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;Overriding Defaults</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;-------------------</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;Yes sir, we have it. Needle includes a `defaults()` method, that lets you override some of the defaults for all future requests. Like this:</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;```js</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;needle.defaults({</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  open_timeout: 60000,</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  user_agent: &#39;MyApp/1.2.3&#39;,</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  parse_response: false });</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;```</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;This will override Needle&#39;s default user agent and 10-second timeout, and disable response parsing, so you don&#39;t need to pass those options in every other request.</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;More advanced Proxy support</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;---------------------------</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;Since you can pass a custom HTTPAgent to Needle you can do all sorts of neat stuff. For example, if you want to use the [`tunnel`](https://github.com/koichik/node-tunnel) module for HTTPS proxying, you can do this:</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;```js</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;var tunnel = require(&#39;tunnel&#39;);</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;var myAgent = tunnel.httpOverHttp({</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  proxy: { host: &#39;localhost&#39; }</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;});</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;needle.get(&#39;foobar.com&#39;, { agent: myAgent });</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;```</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;Otherwise, you can use the [`hpagent`](https://github.com/delvedor/hpagent) package, which keeps the internal sockets alive to be reused.</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;```js</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;const { HttpsProxyAgent } = require(&#39;hpagent&#39;);</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;needle(&#39;get&#39;, &#39;https://localhost:9200&#39;, {</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  agent: new HttpsProxyAgent({</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    keepAlive: true,</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    keepAliveMsecs: 1000,</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    maxSockets: 256,</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    maxFreeSockets: 256,</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    scheduling: &#39;lifo&#39;,</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    proxy: &#39;https://localhost:8080&#39;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  })</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;});</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;```</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;Regarding the &#39;Connection&#39; header</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;---------------------------------</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;Unless you&#39;re running an old version of Node (&lt; 0.11.4), by default Needle won&#39;t set the Connection header on requests, yielding Node&#39;s default behaviour of keeping the connection alive with the target server. This speeds up immensely the process of sending several requests to the same host.</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;On older versions, however, this has the unwanted behaviour of preventing the runtime from exiting, either because of a bug or &#39;feature&#39; that was changed on 0.11.4. To overcome this Needle does set the &#39;Connection&#39; header to &#39;close&#39; on those versions, however this also means that making new requests to the same host doesn&#39;t benefit from Keep-Alive.</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;So if you&#39;re stuck on 0.10 or even lower and want full speed, you can simply set the Connection header to &#39;Keep-Alive&#39; by using `{ connection: &#39;Keep-Alive&#39; }`. Please note, though, that an event loop handler will prevent the runtime from exiting so you&#39;ll need to manually call `process.exit()` or the universe will collapse.</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;Examples Galore</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;---------------</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;### HTTPS GET with Basic Auth</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;```js</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;needle.get(&#39;https://api.server.com&#39;, { username: &#39;you&#39;, password: &#39;secret&#39; },</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  function(err, resp) {</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    // used HTTP auth</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;});</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;```</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;Or use [RFC-1738](http://tools.ietf.org/html/rfc1738#section-3.1) basic auth URL syntax:</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;```js</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;needle.get(&#39;https://username:password@api.server.com&#39;, function(err, resp) {</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    // used HTTP auth from URL</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;});</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;```</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;### Digest Auth</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;```js</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;needle.get(&#39;other.server.com&#39;, { username: &#39;you&#39;, password: &#39;secret&#39;, auth: &#39;digest&#39; },</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  function(err, resp, body) {</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    // needle prepends &#39;http://&#39; to your URL, if missing</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;});</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;```</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;### Custom Accept header, deflate</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;```js</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;var options = {</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  compressed : true,</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  follow     : 10,</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  accept     : &#39;application/vnd.github.full+json&#39;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;}</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;needle.get(&#39;api.github.com/users/tomas&#39;, options, function(err, resp, body) {</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  // body will contain a JSON.parse(d) object</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  // if parsing fails, you&#39;ll simply get the original body</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;});</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;```</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;### GET XML object</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;```js</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;needle.get(&#39;https://news.ycombinator.com/rss&#39;, function(err, resp, body) {</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  // you&#39;ll get a nice object containing the nodes in the RSS</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;});</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;```</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;### GET binary, output to file</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;```js</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;needle.get(&#39;http://upload.server.com/tux.png&#39;, { output: &#39;/tmp/tux.png&#39; }, function(err, resp, body) {</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  // you can dump any response to a file, not only binaries.</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;});</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;```</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;### GET through proxy</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;```js</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;needle.get(&#39;http://search.npmjs.org&#39;, { proxy: &#39;http://localhost:1234&#39; }, function(err, resp, body) {</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  // request passed through proxy</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;});</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;```</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;### GET a very large document in a stream (from 0.7+)</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;```js</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;var stream = needle.get(&#39;http://www.as35662.net/100.log&#39;);</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;stream.on(&#39;readable&#39;, function() {</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  var chunk;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  while (chunk = this.read()) {</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    console.log(&#39;got data: &#39;, chunk);</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  }</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;});</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;```</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;### GET JSON object in a stream (from 0.7+)</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;```js</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;var stream = needle.get(&#39;http://jsonplaceholder.typicode.com/db&#39;, { parse: true });</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;stream.on(&#39;readable&#39;, function() {</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;  var node;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;  // our stream will only emit a single JSON root node.</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  while (node = this.read()) {</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    console.log(&#39;got data: &#39;, node);</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  }</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;});</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;```</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;### GET JSONStream flexible parser with search query (from 0.7+)</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;```js</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160; // The &#39;data&#39; element of this stream will be the string representation</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160; // of the titles of all posts.</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;needle.get(&#39;http://jsonplaceholder.typicode.com/db&#39;, { parse: true })</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;      .pipe(new JSONStream.parse(&#39;posts.*.title&#39;));</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;      .on(&#39;data&#39;, function (obj) {</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        console.log(&#39;got post title: %s&#39;, obj);</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;      });</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;```</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;### File upload using multipart, passing file path</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;```js</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;var data = {</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  foo: &#39;bar&#39;,</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  image: { file: &#39;/home/tomas/linux.png&#39;, content_type: &#39;image/png&#39; }</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;}</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;needle.post(&#39;http://my.other.app.com&#39;, data, { multipart: true }, function(err, resp, body) {</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;  // needle will read the file and include it in the form-data as binary</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;});</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;```</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;### Stream upload, PUT or POST</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;``` js</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;needle.put(&#39;https://api.app.com/v2&#39;, fs.createReadStream(&#39;myfile.txt&#39;), function(err, resp, body) {</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  // stream content is uploaded verbatim</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;});</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;```</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;### Multipart POST, passing data buffer</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;```js</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;var buffer = fs.readFileSync(&#39;/path/to/package.zip&#39;);</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;var data = {</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  zip_file: {</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    buffer       : buffer,</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    filename     : &#39;mypackage.zip&#39;,</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    content_type : &#39;application/octet-stream&#39;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  }</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;}</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;needle.post(&#39;http://somewhere.com/over/the/rainbow&#39;, data, { multipart: true }, function(err, resp, body) {</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  // if you see, when using buffers we need to pass the filename for the multipart body.</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  // you can also pass a filename when using the file path method, in case you want to override</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  // the default filename to be received on the other end.</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;});</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;```</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;### Multipart with custom Content-Type</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;```js</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;var data = {</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  token: &#39;verysecret&#39;,</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  payload: {</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    value: JSON.stringify({ title: &#39;test&#39;, version: 1 }),</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    content_type: &#39;application/json&#39;</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;  }</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;}</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;needle.post(&#39;http://test.com/&#39;, data, { timeout: 5000, multipart: true }, function(err, resp, body) {</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  // in this case, if the request takes more than 5 seconds</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;  // the callback will return a [Socket closed] error</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;});</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;```</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;For even more examples, check out the examples directory in the repo.</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;### Testing</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;To run tests, you need to generate a self-signed SSL certificate in the `test` directory. After cloning the repository, run the following commands:</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    $ mkdir -p test/keys</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    $ openssl genrsa -out test/keys/ssl.key 2048</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    $ openssl req -new -key test/keys/ssl.key -x509 -days 999 -out test/keys/ssl.cert</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;Then you should be able to run `npm test` once you have the dependencies in place.</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;&gt; Note: Tests currently only work on linux-based environments that have `/proc/self/fd`. They *do not* work on MacOS environments.</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;&gt; You can use Docker to run tests by creating a container and mounting the needle project directory on `/app`</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;&gt; `docker create --name Needle -v /app -w /app -v /app/node_modules -i node:argon`</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;Credits</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;-------</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;Written by TomÃ¡s Pollak, with the help of contributors.</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;Copyright</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;---------</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;(c) Fork Ltd. Licensed under the MIT license.</div></div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="needle_2_r_e_a_d_m_e_8md.html">README.md</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
